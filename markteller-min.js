(function(){"use strict";function t(t,e){var s={}.hasOwnProperty;for(var i in e)s.call(e,i)&&(t[i]=e[i]);return t}var e;e=function(){function e(){this.screen.style.position="relative",this.screen.style.backgroundColor="#222",this.scene.id="scene",this.scene.style.position="absolute",this.scene.style.textAlign="center",this.scene.style.width="100%",this.subtitle.id="subtitle",this.subtitle.style.position="absolute",this.subtitle.style.textAlign="center",this.subtitle.style.color="#FFF",this.subtitle.style.fontFamily="Helvetica",this.subtitle.style.width="100%",this.subtitle.style.display="flex",this.subtitle.style.alignItems="center",this.subtitle.style.justifyContent="center"}function s(){window.innerWidth>window.innerHeight?(this.scene.style.height="80%",this.scene.style.top=0,this.subtitle.style.height="20%",this.subtitle.style.bottom=0,this.subtitle.style.fontSize="2.5vw"):(this.scene.style.height="70%",this.scene.style.top=0,this.subtitle.style.height="30%",this.subtitle.style.bottom=0,this.subtitle.style.fontSize="4vh"),i.call(this)}function i(){this.frame.width>this.frame.height?(this.frame.style.width="100%",this.frame.style.height="auto"):(this.frame.style.width="auto",this.frame.style.height="100%")}function n(){var t;this.status="playing",window.speechSynthesis.paused?(window.speechSynthesis.resume(),t=this.speechRecord,setTimeout(function(){t===this.speechRecord&&this._next()},1e3)):u.call(this)}function h(){this.status="paused",window.speechSynthesis.pause()}function o(){var t;switch(t=this,t.actionI){case 0:return r.call(t);case-1:t.actionI=t.actionLen-1,"start"===t.status&&(t.status="paused");break;default:t.actionI-=1}l.call(t)}function c(){return this.actionI===this.actionLen-1?r.call(this):("start"===this.status?this.status="paused":this.actionI+=1,void l.call(this))}function a(t){this.frame.src=t.frame,this.subtitle.innerHTML=t.text,i.call(this),this.opt.progressRender(this.actions[this.actionI].id+" / "+this.actionLen),d(this.baseUrl+"?"+this.actions[this.actionI].id.toString())}function l(){switch(window.speechSynthesis.resume(),window.speechSynthesis.cancel(),this.status){case"playing":u.call(this);break;case"start":case"paused":a.call(this,this.actions[this.actionI])}}function r(){window.speechSynthesis.resume(),this.actionI=-1,this.status="start",window.speechSynthesis.cancel(),a.call(this),d(this.baseUrl)}function u(){var e,s;e=this.actions[this.actionI],a.call(this,(s=t({},e),s.text=null,s)),p.call(this,e.text)}function p(t){var e;e=this,t=t.replace(/&quot;/g,'"'),t=t.replace(/&apos;/g,"'"),window.speechSynthesis.cancel(),window.utterance=new SpeechSynthesisUtterance(t),window.utterance.lang="en-us",window.utterance.rate=1,window.utterance.onstart=function(){return e.subtitle.innerHTML=t},window.utterance.onboundary=function(){return e.speechRecord+=1},window.utterance.onend=function(){if("playing"===e.status&&!window.speechSynthesis.speaking)return e.actionI+=1,e.actionI<e.actionLen?u.call(e):r.call(e)},window.speechSynthesis.speak(window.utterance),window.onbeforeunload=function(){return e.pause()}}function d(t){history.pushState({},null,t)}var y,f;return y=function(i,n){var h,o,c,l,r,u,p,d,y;for(h=this,this.opt={render:".markteller",lang:"en-us"},n&&(this.opt=t(this.opt,n)),void 0===this.opt.progressRender&&(this.opt.progressRender=function(){}),this.screen=document.querySelector(this.opt.render),this.screen.appendChild(this.scene=document.createElement("div")),this.scene.appendChild(this.frame=document.createElement("img")),this.screen.appendChild(this.subtitle=document.createElement("div")),e.call(this),s.call(this),window.addEventListener("resize",function(){s.call(h)}),this.actions=[],o=i.split("\n"),this.title=(c=/^#\s*(.*)/.exec(o[0]))?c[1]:"No title",l=[null,0],r=l[0],u=l[1],p=0,d=o.length;p<d;++p)y=o[p],/^#.*/.exec(y)||/^\s*$/.exec(y)||/<!--.*-->/.exec(y)||((c=/^\!\[.*\]\((.*)\)/.exec(y))?r=c[1]:this.actions.push({text:y,frame:r,id:++u}));return this.actionLen=this.actions.length,this.cover=this.actions[0].frame,this.actionI=0,this.speechRecord=0,(c=/(.+)\?(\d+)$/.exec(location.href))?(this.baseUrl=c[1],this.actionI=-1+parseInt(c[2]),this.status="paused",a.call(this,this.actions[this.actionI])):(this.baseUrl=location.href,this.actionI=0,this.status="start",a.call(this,{frame:this.cover,text:this.title}))},y.prototype.play=function(){n.call(this)},y.prototype.pause=function(){h.call(this)},y.prototype.prev=function(){o.call(this)},y.prototype.next=function(){c.call(this)},y.prototype.getTitle=function(){return this.title},y.prototype.getStatus=function(){return this.status},y.prototype.getLength=function(){return this.actionLen},void 0!==typeof f?(void 0!==typeof module&&module.exports&&(f=module.exports=y),f.Markteller=y):this.Markteller=y,y}.call(this)}).call(this);
//# sourceMappingURL=markteller-min.map