(function(){"use strict";function t(t,e){var s={}.hasOwnProperty;for(var i in e)s.call(e,i)&&(t[i]=e[i]);return t}var e;e=function(){function e(e){var n,c,h,o,l,u,p,d;for(this.opt=t({lang:"en-us"},e),void 0===this.opt.progressRender&&(this.opt.progressRender=function(){}),this.stage=document.querySelector(this.opt.element),this.stage.appendChild(this.scene=document.createElement("div")),this.scene.appendChild(this.sceneImg=document.createElement("img")),this.stage.appendChild(this.subtitle=document.createElement("div")),s.call(this),i.call(this),window.addEventListener("resize",function(){i.call(this)}),this.actions=[],n=this.opt.markdown.split("\n"),this.title=(c=/^#\s*(.*)/.exec(n[0]))?c[1]:"No title",h=[null,0],o=h[0],l=h[1],u=0,p=n.length;u<p;++u)d=n[u],/^#.*/.exec(d)||/^\s*$/.exec(d)||/<!--.*-->/.exec(d)||((c=/^\!\[.*\]\((.*)\)/.exec(d))?o=c[1]:this.actions.push({text:d,scene:o,id:++l}));this.actionLen=this.actions.length,this.cover=this.actions[0].scene,this.actionI=0,this.speechRecord=0,(c=/(.+)\?(\d+)$/.exec(location.href))?(this.baseUrl=c[1],this.actionI=-1+parseInt(c[2]),this.status="paused",r.call(this,this.actions[this.actionI])):(this.baseUrl=location.href,this.actionI=0,this.status="start",a.call(this))}function s(){this.stage.style.position="relative",this.stage.style.backgroundColor="#222",this.scene.id="scene",this.scene.style.position="absolute",this.scene.style.textAlign="center",this.scene.style.width="100%",this.subtitle.id="subtitle",this.subtitle.style.position="absolute",this.subtitle.style.textAlign="center",this.subtitle.style.color="#FFF",this.subtitle.style.fontFamily="Helvetica",this.subtitle.style.width="100%",this.subtitle.style.display="flex",this.subtitle.style.alignItems="center",this.subtitle.style.justifyContent="center"}function i(){window.innerWidth>window.innerHeight?(this.scene.style.height="80%",this.scene.style.top=0,this.subtitle.style.height="20%",this.subtitle.style.bottom=0,this.subtitle.style.fontSize="2.5vw"):(this.scene.style.height="70%",this.scene.style.top=0,this.subtitle.style.height="30%",this.subtitle.style.bottom=0,this.subtitle.style.fontSize="4vh"),this.sceneImg.width>this.sceneImg.height?(this.sceneImg.style.width="100%",this.sceneImg.style.height="auto"):(this.sceneImg.style.width="auto",this.sceneImg.style.height="100%")}function n(){var t;this.status="playing",window.speechSynthesis.paused?(window.speechSynthesis.resume(),t=this.speechRecord,setTimeout(function(){t===this.speechRecord&&this._next()},1e3)):p.call(this)}function c(){this.status="paused",window.speechSynthesis.pause()}function h(){var t;switch(t=this,t.actionI){case 0:return u.call(t);case-1:t.actionI=t.actionLen-1,"start"===t.status&&(t.status="paused");break;default:t.actionI-=1}l.call(t)}function o(){return this.actionI===this.actionLen-1?u.call(this):("start"===this.status?this.status="paused":this.actionI+=1,void l.call(this))}function a(){this.sceneImg.src=this.cover,this.subtitle.innerHTML=this.title}function l(){switch(window.speechSynthesis.resume(),window.speechSynthesis.cancel(),this.status){case"playing":p.call(this);break;case"start":case"paused":r.call(this,this.actions[this.actionI])}}function u(){window.speechSynthesis.resume(),this.actionI=-1,this.status="start",window.speechSynthesis.cancel(),a.call(this),y(this.baseUrl)}function r(t){this.subtitle.innerHTML=t.text,this.sceneImg.src=t.scene,this.opt.progressRender(this.actions[this.actionI].id+" / "+this.actionLen),y(this.baseUrl+"?"+this.actions[this.actionI].id.toString())}function p(){var e,s;e=this.actions[this.actionI],r.call(this,(s=t({},e),s.text=null,s)),d.call(this,e.text)}function d(t){var e;e=this,t=t.replace(/&quot;/g,'"'),t=t.replace(/&apos;/g,"'"),window.speechSynthesis.cancel(),window.utterance=new SpeechSynthesisUtterance(t),window.utterance.lang="en-us",window.utterance.rate=1,window.utterance.onstart=function(){return e.subtitle.innerHTML=t},window.utterance.onboundary=function(){return e.speechRecord+=1},window.utterance.onend=function(){if("playing"===e.status&&!window.speechSynthesis.speaking)return e.actionI+=1,e.actionI<e.actionLen?p.call(e):u.call(e)},window.speechSynthesis.speak(window.utterance),window.onbeforeunload=function(){return e.pause()}}function y(t){history.pushState({},null,t)}var w;return e.prototype.play=function(){n.call(this)},e.prototype.pause=function(){c.call(this)},e.prototype.next=function(){o.call(this)},e.prototype.prev=function(){h.call(this)},e.prototype.getTitle=function(){return this.title},e.prototype.getStatus=function(){return this.status},e.prototype.getLength=function(){return this.actionLen},"undefined"!=typeof w?("undefined"!=typeof module&&module.exports&&(w=module.exports=e),w.Storyteller=e):this.Storyteller=e,e}.call(this)}).call(this);
//# sourceMappingURL=storyteller-min.map